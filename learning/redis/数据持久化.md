## 持久化选项
Redis提供了两种不同的持久化方法来将数据存储到硬盘里面：RDB、AOF。一种方法叫快照 （snapshotting），它可以将存在于某一时刻的所有数据都写入硬盘里面。另一种方法叫只追加文件 （append-only file，AOF），它会在执行写命令时，将被执行的写命令复制到硬盘里面。这两种持久化方法既可以同时使用，又可以单独使用，在某些情况下甚至可以两种方法都不使用，具体选择哪种持久化方法需要根据用户的数据以及应用来决定。

### 快照持久化
Redis可以通过创建快照来获得存储在内存里面的数据在某个时间点上的副本。在创建快照之后，用户可以对快照进行备份，可以将快照复制到其他服务器从而创建具有相同数据的服务器副本，还可以将快照留在原地以便重启服务器时使用。

客户端可以通过向Redis发送BGSAVE 命令来创建一个快照。对于支持BGSAVE 命令的平台来说（基本上所有平台都支持，除了Windows平台），Redis会调用fork ① 来创建一个子进程，然后子进程负责将快照写入硬盘，而父进程则继续处理命令请求。

客户端还可以通过向Redis发送SAVE 命令来创建一个快照，接到SAVE 命令的Redis服务器在快照创建完毕之前将不再响应任何其他命令。SAVE 命令并不常用，我们通常只会在没有足够内存去执行BGSAVE 命令的情况下，又或者即使等待持久化操作执行完毕也无所谓的情况下，才会使用这个命令。

如果用户设置了save 配置选项，比如save 60 10000 ，那么从Redis最近一次创建快照之后开始算起，当“60秒之内有10 000次写入”这个条件被满足时，Redis就会自动触发BGSAVE 命令。如果用户设置了多个save 配置选项，那么当任意一个save 配置选项所设置的条件被满足时，Redis就会触发一次BGSAVE 命令。

当Redis通过SHUTDOWN 命令接收到关闭服务器的请求时，或者接收到标准TERM 信号时，会执行一个SAVE 命令，阻塞所有客户端，不再执行客户端发送的任何命令，并在SAVE 命令执行完毕之后关闭服务器。

当一个Redis服务器连接另一个Redis服务器，并向对方发送SYNC 命令来开始一次复制操作的时候，如果主服务器目前没有在执行BGSAVE 操作，或者主服务器并非刚刚执行完BGSAVE 操作，那么主服务器就会执行BGSAVE 命令。

### AOF持久化
AOF持久化会将被执行的写命令写到AOF文件的末尾，以此来记录数据发生的变化。因此，Redis只要从头到尾重新执行一次AOF文件包含的所有写命令，就可以恢复AOF文件所记录的数据集。

###### appendfsync 选项及同步频率
选项 | 同步频率 | 
---|---|
always|每个Redis写命令都要同步写入硬盘。这样做会严重降低Redis的速度|
everysec|每秒执行一次同步，显式地将多个写命令同步到硬盘| 
no|让操作系统来决定应该何时进行同步|

